FROM node:14.15.4-alpine3.10 AS base
WORKDIR /app
RUN apk update && apk add bash

COPY package*.json yarn.lock /app/

COPY .env.test /app/.env.test

# copy source files
COPY graphql /app/graphql

COPY tsconfig.json /app/tsconfig.json

COPY tsconfig.prod.json /app/tsconfig.prod.json

COPY prisma /app/prisma

COPY utils ./app/utils

RUN yarn install --frozen-lockfile 

RUN yarn generate
RUN yarn prisma generate

RUN yarn build
CMD [ "yarn", "start" ]